<html>
	<head>
		<title>Retina Image Survey</title>
		<style>

			.image {
				width: 300px;
				height: 187px;
				margin-top: 10px;
			}

			.image.retina {
				background-size: 300px 187px !important;
			}

			.survey-panel {
				display: none;
			}

		</style>
	</head>
	<body>
		
		<!-- Select Device -->
		<div id="device-select" class="survey-panel">
			
			<h1>Select your device:</h1>

			<button>Retina</button>
			<button>Non-retina</button>
			
		</div>

		<!-- Image 1 Survey -->
		<div id="image1" class="survey-panel">
			
			<h1>Which image looks sharper?</h1>
			
			<div class="image" id="image-1-1"></div>
			<div class="image" id="image-1-2"></div>
		
		</div>
		
		<!-- Image 2 Survey -->
		<div id="image2" class="survey-panel">
		
			<h1>Which image looks sharper?</h1>
		
			<div class="image" id="image-2-1"></div>
			<div class="image" id="image-2-2"></div>
		
		</div>
		
		<!-- Image 3 Survey -->
		<div id="image3" class="survey-panel">
		
			<h1>Which image looks sharper?</h1>
		
			<div class="image" id="image-3-1"></div>
			<div class="image" id="image-3-2"></div>
		
		</div>
		
		<!-- Image 4 Survey -->
		<div id="image4" class="survey-panel">
		
			<h1>Which image looks sharper?</h1>
		
			<div class="image" id="image-4-1"></div>
			<div class="image" id="image-4-2"></div>
		
		</div>
		
		<!-- Survey Results -->
		<div id="results" class="survey-panel">
			
			<h1>Survey Results</h1>
			<h3 id="numNonRetina"></h3>
			<h2>Total</h2>
			<h3 id="retinaSelected"></h3>
			<h3 id="nonRetinaSelected"></h3>
			<h2>Retina Devices</h2>
			<h3 id="retinaSelectedRetina"></h3>
			<h3 id="nonRetinaSelectedRetina"></h3>
			<h2>Non-Retina Devices</h2>
			<h3 id="retinaSelectedNonRetina"></h3>
			<h3 id="nonRetinaSelectedNonRetina"></h3>

		</div>
		
		<!-- Scripts -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script>
			window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
		</script>
		<script>

			// Survey Object
			var Survey = {};

			// Image Source Files
			Survey.img = {};

			Survey.img.one = {};
			Survey.img.one.retina = "images/img1-retina.jpg";
			Survey.img.one.full = "images/img1-full.jpg";

			Survey.img.two = {};
			Survey.img.two.retina = "images/img2-retina.jpg";
			Survey.img.two.full = "images/img2-full.jpg";

			Survey.img.three = {};
			Survey.img.three.retina = "images/img3-retina.jpg";
			Survey.img.three.full = "images/img3-full.jpg";

			Survey.img.four = {};
			Survey.img.four.retina = "images/img4-retina.jpg";
			Survey.img.four.full = "images/img4-full.jpg";

			// Survey Data
			Survey.data = {};

			// Set Random Images
			Survey.setRandomImg = function (number) {

				// Random number
				var rand = Math.round(Math.random()),
					other = rand === 0 ? 1 : 0,
					images = ["zero", "one", "two", "three", "four"];

				// Insert random image
				$("#image" + number + " div:eq(" + rand + ")")
					.addClass("retina")
					.css("background", "url(" + Survey.img[images[number]].retina + ") no-repeat center");
				$("#image" + number + " div:eq(" + other + ")")
					.css("background", "url(" + Survey.img[images[number]].full + ") no-repeat center");

			};

			// Show Results
			Survey.showResults = function () {

				var numNonRetina = 0;

				$.each(Survey.data, function () {

					if (this == "Non-retina") {
						numNonRetina += 1;
					}

				});

				// Display number of non-retina images selected
				$("#numNonRetina").text("Non-retina images selected: " + numNonRetina);

			};

			// Save Survey Data
			Survey.saveData = function () {

				$.ajax({
					url: "/survey",
					type: "POST",
					data: Survey.data,
					success: function () {

						$("#results").prepend('<p class="success">Results saved!</p>')

					},
					error: function () {

						$("#results").prepend('<p class="error">Error saving results.');

					}
				});

			};

			// Show first panel
			$("#device-select").show();

			for (var i = 1; i < 5; i++) {

				Survey.setRandomImg(i);

			}

			/**
			 * Event Binding
			 */
			
			$("#device-select button").click(function () {

				// Save device info
				Survey.data.device = $(this).text();

				$(this).parent().hide();

				$("#image1").show();

			});

			$(".image").click(function () {

				var imgNum = parseInt($(this).parent().attr("id").substr(-1), 10),
					isRetina = $(this).hasClass("retina"),
					imgType = isRetina ? "Retina" : "Non-retina";

				switch (imgNum) {
				case 1:
					Survey.data.image1 = imgType;
					$(".survey-panel").hide();
					$("#image2").show();
					break;
				case 2:
					Survey.data.image2 = imgType;
					$(".survey-panel").hide();
					$("#image3").show();
					break;
				case 3:
					Survey.data.image3 = imgType;
					$(".survey-panel").hide();
					$("#image4").show();
					break;
				case 4:
					Survey.data.image4 = imgType;
					$(".survey-panel").hide();
					$("#results").show();
					Survey.showResults();
					break;
				}

			});


		</script>
		
	</body>
</html>